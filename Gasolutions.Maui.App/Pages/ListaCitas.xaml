<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Gasolutions.Maui.App.Pages.ListaCitas">

    <AbsoluteLayout>

        <Image Source="barber.jpg" Opacity="0.90" Aspect="AspectFill" AbsoluteLayout.LayoutBounds="0,0,1,1" AbsoluteLayout.LayoutFlags="All" />

        <Grid RowDefinitions="Auto, Auto, *" Padding="20" AbsoluteLayout.LayoutBounds="0,0,1,1" AbsoluteLayout.LayoutFlags="All">
            <VerticalStackLayout Spacing="15">
                <Label Text="Citas Agendadas ðŸ—“ï¸" TextColor="#c0aa4f" FontSize="Large" FontAttributes="Bold"  HorizontalOptions="Start" />
                <Frame CornerRadius="12" Padding="0" HasShadow="True" BackgroundColor="#333" BorderColor="#c0aa4f" WidthRequest="260" HorizontalOptions="Center">
                    <DatePicker x:Name="datePicker" Date="{Binding FechaSeleccionada, Mode=TwoWay}" Format="dd/MM/yyyy" BackgroundColor="#333333" TextColor="White" WidthRequest="250" FontSize="20" FontAttributes="Bold"  HeightRequest="65"/>
                </Frame>
                <HorizontalStackLayout Grid.Row="1" HorizontalOptions="Center" Spacing="10" Margin="0,10">
                    <Button Text="Buscar Reservas" Clicked="RecuperarCitasPorFecha" BackgroundColor="#c0aa4f" TextColor="White" CornerRadius="10"/>
                    <Button Text="Eliminar Seleccionados" Clicked="EliminarCitasSeleccionadas" BackgroundColor="Gray" TextColor="White" CornerRadius="10"/>
                </HorizontalStackLayout>
                <CollectionView ItemsSource="{Binding CitasFiltradas}" Grid.Row="2" HeightRequest="590">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Padding="10" Margin="5" BorderColor="#444" BackgroundColor="#7d7c76" CornerRadius="12" HasShadow="True">
                                <HorizontalStackLayout Spacing="10">
                                    <CheckBox IsChecked="{Binding Seleccionado, Mode=TwoWay}" Color="#c0aa4f"/>
                                    <VerticalStackLayout>
                                        <Label Text="{Binding Nombre}" FontSize="18" FontAttributes="Bold" TextColor="Black"/>
                                        <Label Text="{Binding FechaConFormato, StringFormat='{0:hh:mm tt}'}" FontSize="16" TextColor="Honeydew"/>
                                        <Label Text="{Binding Telefono}" FontSize="14" TextColor="White"/>
                                    </VerticalStackLayout>
                                </HorizontalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </Grid>
        <Grid x:Name="LoaderOverlay" BackgroundColor="#80000000" IsVisible="False" InputTransparent="False" AbsoluteLayout.LayoutBounds="0,0,1,1" AbsoluteLayout.LayoutFlags="All" VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand" ZIndex="10">
            <BoxView BackgroundColor="Transparent">
                <BoxView.GestureRecognizers>
                    <TapGestureRecognizer />
                </BoxView.GestureRecognizers>
            </BoxView>
            <ActivityIndicator IsRunning="True" Color="#c0aa4f" VerticalOptions="Center" HorizontalOptions="Center" WidthRequest="50" HeightRequest="50"/>
        </Grid>
    </AbsoluteLayout>
</ContentPage>
