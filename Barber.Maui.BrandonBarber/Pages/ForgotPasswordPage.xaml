<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Barber.Maui.BrandonBarber.Pages.ForgotPasswordPage"
             BackgroundColor="#0E2A36" 
             Shell.NavBarIsVisible="False"
             Title="Recuperar Contraseña">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="RecoveryEntryStyle" TargetType="Entry">
                <Setter Property="BackgroundColor" Value="#E0F7FA" />
                <Setter Property="TextColor" Value="#0E2A36" />
                <Setter Property="PlaceholderColor" Value="#90A4AE" />
                <Setter Property="HeightRequest" Value="45" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="Margin" Value="0,5,0,10" />
            </Style>
            <Style x:Key="RecoveryButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="#FF6F91" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="CornerRadius" Value="10" />
                <Setter Property="HeightRequest" Value="45" />
                <Setter Property="FontSize" Value="16" />
            </Style>
            <Style x:Key="SecondaryButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="#3a3a3a" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="CornerRadius" Value="10" />
                <Setter Property="HeightRequest" Value="45" />
                <Setter Property="FontSize" Value="16" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView Padding="30">
        <Grid>
            <VerticalStackLayout Spacing="20" VerticalOptions="Center">

                <!-- Header -->
                <Image Source="gentlemen.png" WidthRequest="180" HeightRequest="180" HorizontalOptions="Center" />

                <Label Text="🔒 Recuperar Contraseña" 
                       FontSize="24" 
                       TextColor="White" 
                       HorizontalOptions="Center" 
                       FontAttributes="Bold"/>

                <!-- Step 1: Email Input -->
                <StackLayout x:Name="EmailStep" Spacing="15">
                    <Label Text="Ingresa tu email para recibir un código de recuperación" 
                           FontSize="14" 
                           TextColor="#B0BEC5" 
                           HorizontalOptions="Center" 
                           HorizontalTextAlignment="Center"/>

                    <Border BackgroundColor="#E0F7FA" 
                            StrokeShape="RoundRectangle 25" 
                            StrokeThickness="0" 
                            Padding="0" 
                            HorizontalOptions="Fill">
                        <Grid Padding="12,0" ColumnDefinitions="Auto, *" VerticalOptions="Center">
                            <Image Source="usericons.png" WidthRequest="25" HeightRequest="25" VerticalOptions="Center" />
                            <Entry Grid.Column="1" 
                                   x:Name="EmailEntry" 
                                   TextColor="#0E2A36" 
                                   Placeholder="correo@ejemplo.com" 
                                   PlaceholderColor="#90A4AE" 
                                   FontSize="14" 
                                   HeightRequest="45" 
                                   BackgroundColor="Transparent" 
                                   HorizontalOptions="Fill" 
                                   VerticalOptions="Center" 
                                   Keyboard="Email"/>
                        </Grid>
                    </Border>

                    <Button Text="Enviar Código" 
                            Style="{StaticResource RecoveryButtonStyle}" 
                            Clicked="OnSendCodeClicked" 
                            HorizontalOptions="Fill"/>
                </StackLayout>

                <!-- Step 2: Token and New Password -->
                <StackLayout x:Name="ResetStep" Spacing="15" IsVisible="False">
                    <Label Text="✉️ Revisa tu email y ingresa el código recibido junto con tu nueva contraseña" 
                           FontSize="14" 
                           TextColor="#B0BEC5" 
                           HorizontalOptions="Center" 
                           HorizontalTextAlignment="Center"/>

                    <!-- Token Input -->
                    <Border BackgroundColor="#E0F7FA" 
                            StrokeShape="RoundRectangle 25" 
                            StrokeThickness="0" 
                            Padding="0" 
                            HorizontalOptions="Fill">
                        <Grid Padding="12,0" ColumnDefinitions="Auto, *" VerticalOptions="Center">
                            <Image Source="lock.png" WidthRequest="25" HeightRequest="25" VerticalOptions="Center" />
                            <Entry Grid.Column="1" 
                                   x:Name="TokenEntry" 
                                   TextColor="#0E2A36" 
                                   Placeholder="123456" 
                                   PlaceholderColor="#90A4AE" 
                                   FontSize="18" 
                                   HeightRequest="45" 
                                   BackgroundColor="Transparent" 
                                   HorizontalOptions="Fill" 
                                   VerticalOptions="Center" 
                                   Keyboard="Numeric"
                                   MaxLength="6"
                                   HorizontalTextAlignment="Center"
                                   FontAttributes="Bold"/>
                        </Grid>
                    </Border>

                    <!-- New Password Input -->
                    <Border BackgroundColor="#E0F7FA" 
                            StrokeShape="RoundRectangle 25" 
                            StrokeThickness="0" 
                            Padding="0" 
                            HorizontalOptions="Fill">
                        <Grid Padding="12,0" ColumnDefinitions="Auto, *" VerticalOptions="Center">
                            <Image Source="lock.png" WidthRequest="25" HeightRequest="25" VerticalOptions="Center" />
                            <Entry Grid.Column="1" 
                                   x:Name="NewPasswordEntry" 
                                   TextColor="#0E2A36" 
                                   Placeholder="Nueva contraseña" 
                                   PlaceholderColor="#90A4AE" 
                                   FontSize="14" 
                                   HeightRequest="45" 
                                   BackgroundColor="Transparent" 
                                   HorizontalOptions="Fill" 
                                   VerticalOptions="Center" 
                                   IsPassword="True"/>
                        </Grid>
                    </Border>

                    <!-- Confirm Password Input -->
                    <Border BackgroundColor="#E0F7FA" 
                            StrokeShape="RoundRectangle 25" 
                            StrokeThickness="0" 
                            Padding="0" 
                            HorizontalOptions="Fill">
                        <Grid Padding="12,0" ColumnDefinitions="Auto, *" VerticalOptions="Center">
                            <Image Source="lock.png" WidthRequest="25" HeightRequest="25" VerticalOptions="Center" />
                            <Entry Grid.Column="1" 
                                   x:Name="ConfirmPasswordEntry" 
                                   TextColor="#0E2A36" 
                                   Placeholder="Confirmar contraseña" 
                                   PlaceholderColor="#90A4AE" 
                                   FontSize="14" 
                                   HeightRequest="45" 
                                   BackgroundColor="Transparent" 
                                   HorizontalOptions="Fill" 
                                   VerticalOptions="Center" 
                                   IsPassword="True"/>
                        </Grid>
                    </Border>

                    <Button Text="Restablecer Contraseña" 
                            Style="{StaticResource RecoveryButtonStyle}" 
                            Clicked="OnResetPasswordClicked" 
                            HorizontalOptions="Fill"/>

                    <Button Text="Reenviar Código" 
                            Style="{StaticResource SecondaryButtonStyle}" 
                            Clicked="OnResendCodeClicked" 
                            HorizontalOptions="Fill"/>
                </StackLayout>

                <!-- Messages -->
                <Label x:Name="MessageLabel" 
                       TextColor="#4CAF50" 
                       FontSize="14" 
                       HorizontalOptions="Center" 
                       HorizontalTextAlignment="Center"
                       IsVisible="False" />

                <Label x:Name="ErrorLabel" 
                       TextColor="#FF6F91" 
                       FontSize="14" 
                       HorizontalOptions="Center" 
                       HorizontalTextAlignment="Center"
                       IsVisible="False" />

                <!-- Back to Login -->
                <HorizontalStackLayout HorizontalOptions="Center" Margin="0,20,0,0">
                    <Label Text="¿Recordaste tu contraseña?" TextColor="#B0BEC5" FontSize="Body"/>
                    <Label Text=" Iniciar Sesión" TextColor="#FF6F91" FontSize="Body" FontAttributes="Bold">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnBackToLoginClicked" />
                        </Label.GestureRecognizers>
                    </Label>
                </HorizontalStackLayout>

                <!-- Loading Indicator -->
                <ActivityIndicator x:Name="LoadingIndicator" 
                                   IsRunning="False" 
                                   IsVisible="False" 
                                   Color="#FF6F91" 
                                   HorizontalOptions="Center" />

            </VerticalStackLayout>
        </Grid>
    </ScrollView>
</ContentPage>